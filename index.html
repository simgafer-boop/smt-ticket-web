<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ticket SMT – Générateur</title>

<!-- Librería para generar PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{ --brand:#1f5ca8; --brand-2:#f59e0b; --ink:#111827; }
  body{ margin:0; background:#f3f4f6; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif; }
  header{ padding:10px 16px; background:#fff; font-size:16px; font-weight:600; }
  .wrap{ max-width:700px; margin:auto; padding:12px; }

  .ticket{
    width:340px;
    min-height:480px;
    margin:auto;
    background:#fff;
    border:1px dashed #cbd5e1;
    border-radius:10px;
    overflow:hidden;
  }

  .top{ padding:12px 10px 4px; text-align:center; border-bottom:2px solid #e5e7eb; }
  .top img{ height:65px; object-fit:contain; }

  .body{ padding:12px 14px; font-size:15px; }
  .body h2{ font-size:18px; margin:6px 0 10px; color:var(--ink); font-weight:700; }

  .row{ display:flex; justify-content:space-between; margin:6px 0; font-size:15px; }
  .muted{ color:#6b7280; font-size:13px; }

  .price{
    font-size:38px;
    color:var(--brand);
    font-weight:800;
    margin:14px 0;
    text-align:center;
  }

  .bottom{ text-align:center; padding:10px; border-top:2px solid #e5e7eb; }
  .bon{ font-size:16px; font-weight:700; color:var(--brand-2); }

  .card{ background:#fff; padding:12px; border-radius:10px; margin-top:14px; }

  .prices{ display:flex; gap:10px; }

  .price-btn{
    flex:1;
    border:2px solid var(--brand);
    padding:12px;
    background:#fff;
    font-weight:700;
    border-radius:8px;
    cursor:pointer;
    font-size:16px;
  }

  .price-btn.active{ background:var(--brand); color:#fff; }

  .actions{ margin-top:10px; display:flex; gap:10px; }

  .primary{
    flex:1;
    background:var(--brand);
    color:#fff;
    border:none;
    padding:12px;
    font-size:16px;
    border-radius:8px;
    cursor:pointer;
  }

  .ghost{
    flex:1;
    border:1px solid var(--brand);
    color:var(--brand);
    padding:12px;
    font-size:16px;
    border-radius:8px;
    cursor:pointer;
  }

</style>
</head>

<body>

<header>Ticket SMT – générateur</header>

<div class="wrap">

  <!-- IMPORTANTE: este ID lo usamos para el PDF -->
  <div class="ticket" id="ticket">
    <div class="top">
      <img src="logo_smt.png" alt="Logo SMT"/>
    </div>

    <div class="body">
      <div class="muted">Ticket de transport</div>
      <h2>SMT – Billet client</h2>

      <div class="row"><span class="muted">Date</span><strong id="t-date">—</strong></div>
      <div class="row"><span class="muted">Heure</span><strong id="t-time">—</strong></div>

      <div class="muted" style="margin-top:8px">Prix</div>
      <div class="price" id="t-price">—</div>
    </div>

    <div class="bottom">
      <div class="bon">bon voyage</div>
    </div>
  </div>

  <div class="card">
    <div class="muted" style="margin-bottom:6px">Choisissez le prix du billet :</div>

    <div class="prices">
      <button class="price-btn" data-val="1,20€">1,20€</button>
      <button class="price-btn" data-val="1,80€">1,80€</button>
    </div>

    <div class="actions">
      <button class="primary" id="btn-make">Générer le billet</button>
      <button class="ghost" id="btn-download" disabled>Télécharger le ticket</button>
    </div>
  </div>

</div>

<script>

const priceBtns=[...document.querySelectorAll('.price-btn')];
let selectedPrice=null;

function setPrice(v){
  selectedPrice=v;
  priceBtns.forEach(b=>b.classList.toggle('active',b.dataset.val===v));
  document.getElementById('t-price').textContent=v||'—';
}

priceBtns.forEach(b=>b.addEventListener('click',()=>setPrice(b.dataset.val)));

function formatDateTime(){
  const tz='America/Guadeloupe';
  const now=new Date();
  const fDate=new Intl.DateTimeFormat('fr-FR',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit'}).format(now);
  const fTime=new Intl.DateTimeFormat('fr-FR',{timeZone:tz,hour:'2-digit',minute:'2-digit'}).format(now);
  return {fDate,fTime};
}

document.getElementById('btn-make').addEventListener('click',()=>{
  if(!selectedPrice){alert('Sélectionnez un prix.');return;}
  const {fDate,fTime}=formatDateTime();
  document.getElementById('t-date').textContent=fDate;
  document.getElementById('t-time').textContent=fTime;
  document.getElementById('btn-download').disabled=false;
});


/* DESCARGA DIRECTA PDF (SIN IMPRIMIR) */
document.getElementById('btn-download').addEventListener('click',()=>{

  const { jsPDF } = window.jspdf;

  const doc = new jsPDF({
    orientation: "portrait",
    unit: "px",
    format: [380, 600]  // tamaño personalizado = 1 sola página
  });

  const ticket = document.getElementById("ticket");

  doc.html(ticket, {
    callback: function (doc) {
      doc.save("ticket-client.pdf");
    },
    x: 10,
    y: 10
  });

});

</script>

</body>
</html>
